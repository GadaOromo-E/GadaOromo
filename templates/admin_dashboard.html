<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard | {{ APP_NAME }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="container">

  <div class="topbar">
    <div class="title-row">
      <div>
        <h2 style="margin:0;">Admin Dashboard</h2>
        <div class="subtle">Approve or reject pending submissions.</div>
      </div>
      <a class="btn danger" href="/logout">üö™ Logout</a>
    </div>
  </div>

  <div class="card">
    <div class="quick-actions">
      <a class="btn" href="/">üè† Home</a>
      <a class="btn" href="/translate">üåç Translator</a>
      <a class="btn" href="/submit">‚ûï Submit Word</a>
      <a class="btn" href="/submit_phrase">‚ûï Submit Phrase</a>
      <a class="btn" href="/admin/import">üì• Import Words</a>
      <a class="btn" href="/admin/manage">üõ° Admin Management</a>
    </div>
  </div>

  <div class="card">
    <h2>Pending Words</h2>

    {% if pending and pending|length > 0 %}
      <div class="grid">
        {% for p in pending %}
          <div class="card" style="margin-top:0;">
            <div class="subtle">English</div>
            <div class="result-box" style="margin-top:8px;"><b>{{ p[1] }}</b></div>

            <div class="subtle" style="margin-top:10px;">Oromo</div>
            <div class="result-box" style="margin-top:8px;"><b>{{ p[2] }}</b></div>

            <div class="small-actions">
              <a class="btn primary" href="/approve/{{ p[0] }}">‚úÖ Approve</a>
              <a class="btn danger" href="/reject/{{ p[0] }}" onclick="return confirm('Reject this word?');">‚ùå Reject</a>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="result-box">No pending words right now ‚úÖ</div>
    {% endif %}
  </div>

  <div class="card">
    <h2>Pending Phrases</h2>

    {% if pending_phrases and pending_phrases|length > 0 %}
      <div class="grid">
        {% for p in pending_phrases %}
          <div class="card" style="margin-top:0;">
            <div class="subtle">English phrase</div>
            <div class="result-box" style="margin-top:8px;"><b>{{ p[1] }}</b></div>

            <div class="subtle" style="margin-top:10px;">Oromo phrase</div>
            <div class="result-box" style="margin-top:8px;"><b>{{ p[2] }}</b></div>

            <div class="small-actions">
              <a class="btn primary" href="/approve_phrase/{{ p[0] }}">‚úÖ Approve</a>
              <a class="btn danger" href="/reject_phrase/{{ p[0] }}" onclick="return confirm('Reject this phrase?');">‚ùå Reject</a>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="result-box">No pending phrases right now ‚úÖ</div>
    {% endif %}
  </div>

  <!-- ===== Pending Audio ===== -->
  <div class="card">
    <h2>Pending Audio</h2>
    <div class="subtle">
      Admin must listen first, then approve or reject.
      <br>Note: Users can submit multiple recordings (pending). Only <b>approved</b> should block new mic submissions.
    </div>

    {% if pending_audio and pending_audio|length > 0 %}
      <div class="grid">
        {% for a in pending_audio %}
          {# a = (id, entry_type, entry_id, lang, file_path) #}
          <div class="card" style="margin-top:0;">

            <div class="subtle">Entry</div>
            <div class="result-box" style="margin-top:8px;">
              <b>{{ a[1] }}</b> #{{ a[2] }} ‚Äî <b>{{ a[3] }}</b>
            </div>

            {% if a[1] == "word" %}
              {% set _row = (words_lookup[a[2]] if words_lookup is defined and a[2] in words_lookup else None) %}
              {% if _row %}
                <div class="subtle" style="margin-top:10px;">Word text</div>
                <div class="result-box" style="margin-top:8px;">
                  <b>EN:</b> {{ _row[0] }} <br>
                  <b>OM:</b> {{ _row[1] }}
                </div>
              {% endif %}
            {% elif a[1] == "phrase" %}
              {% set _row = (phrases_lookup[a[2]] if phrases_lookup is defined and a[2] in phrases_lookup else None) %}
              {% if _row %}
                <div class="subtle" style="margin-top:10px;">Phrase text</div>
                <div class="result-box" style="margin-top:8px;">
                  <b>EN:</b> {{ _row[0] }} <br>
                  <b>OM:</b> {{ _row[1] }}
                </div>
              {% endif %}
            {% endif %}

            <!-- ‚úÖ FIX: Correct upload URL -->
            <div class="subtle" style="margin-top:10px;">Audio preview</div>
            <audio controls preload="none" style="width:100%; margin-top:8px;">
              <source src="/{{ a[4] }}">
              Your browser does not support audio playback.
            </audio>

            <!-- ‚úÖ FIX: must be GET links because app.py uses GET routes -->
            <div class="small-actions" style="margin-top:10px;">
              <a class="btn primary" href="/approve_audio/{{ a[0] }}">‚úÖ Approve</a>
              <a class="btn danger" href="/reject_audio/{{ a[0] }}" onclick="return confirm('Reject this audio and delete the file?');">‚ùå Reject</a>
            </div>

            <div class="muted" style="margin-top:8px; font-size:14px;">
              Tip: Approve only the best recording. Reject removes the pending audio file.
            </div>

          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="result-box">No pending audio right now ‚úÖ</div>
    {% endif %}
  </div>

</div>

</body>
</html>







